{%- if classes %}
from abc import ABC
{% endif %}

{%- for class_definition in classes %}

@dataclass
{% if class_definition.super_class %}
class {{ class_definition.name }}({{ class_definition.super_class }}):
{% elif class_definition.abstract %}
class {{ class_definition.name }}(ABC):
{% else %}
class {{ class_definition.name }}:
{% endif %}

    class Meta:
        name = "{{ class_definition.identifier }}"
        namespace = "{{ render_config['namespace_map']['ili'] }}"

    {%- if class_definition.doc %}
    """
    {{ " ".join(class_definition.doc) }}
    {% if class_definition.attributes %}
    Args:
    {%- for attribute in class_definition.attributes %}
        {{ attribute.name }}: {{ " ".join(attribute.doc) }}
    {%- endfor %}
    {%- endif %}
    """
    {%- endif -%}


{%- for attribute in class_definition.attributes %}
{%- if attribute.enumeration %}
    {%- set enumerations=[attribute.enumeration] %}
    {%- macro render_enumerations() %}{% include "enumerations.jinja2" %}{% endmacro %}
    {{ render_enumerations() | indent(4, true) }}
{%- endif %}
{%- if attribute.line_type %}
    {%- set line_types=[attribute.line_type] %}
    {%- macro render_line_types() %}{% include "line_types.jinja2" %}{% endmacro %}
    {{ render_line_types() | indent(4, true) }}
{%- endif %}
{%- endfor %}
{%-if class_definition.oid  %}
    {{ class_definition.oid.name }}: {{ class_definition.oid.type }} = field(
        default=None,
        metadata={
            "type": "Attribute",
            "name": "TID",
            "interlis": {
                "meta_attributes": {},
                "type_restrictions": {{ class_definition.oid.type_restrictions }}
            }
        }
    )
{%- else %}
{%- if class_definition.kind == 'Class' %}
    TID: str = field(
        default=None,
        metadata={
            "type": "Attribute",
            "name": "TID",
            "interlis": {
                "meta_attributes": {},
                "type_restrictions": None
            }
        }
    )
{%- endif %}
{%- endif %}
{% for attribute in class_definition.attributes %}
{%- if attribute.type == 'BinBlBoxType' %}

    @dataclass
    class BinBlBox:
        class Meta:
            namespace = "{{ render_config['namespace_map']['ili'] }}"
        BINBLBOX: BinBlBoxType = field(
            metadata={
                "type": "Element",
                "namespace": "{{ render_config['namespace_map']['ili'] }}",
            }
        )

{% endif %}
    {{ attribute.name }}: {% if attribute.type == 'BinBlBoxType' %}"{{ class_definition.name }}.BinBlBox"{% else %}{% if attribute.name == attribute.type or class_definition.name == attribute.type %}"{{ attribute.type }}"{% else %}{{ attribute.type }}{% endif %}{% endif %} = field(
        default=None,
        metadata={
            "type": "Element",
            "namespace": "{{ render_config['namespace_map']['ili'] }}",
            {%- if attribute.type_restrictions['type_related_type'] %}
            "name": "{{ attribute.identifier.replace('ili2py.', '') }}",
            {%- endif %}
            "interlis": {
                "oid": "{{ attribute.identifier }}",
                "meta_attributes": {
                    {%- for item in attribute.meta_attributes %}
                        "{{ item.name }}": "{{ item.value }}",
                    {%- endfor %}
                },
                "type_restrictions": {{ attribute.type_restrictions }}
            }
        }
    )
{%- endfor %}

    @property
    def metadata(self) -> dict:
        return {
            "interlis": {
                "oid": "{{ class_definition.identifier }}",
                "kind": "{{ class_definition.kind }}",
                "meta_attributes": {
                    {%- for item in class_definition.meta_attributes %}
                        "{{ item.name }}": "{{ item.value }}",
                    {%- endfor %}
                }
            }
        }
{% endfor -%}