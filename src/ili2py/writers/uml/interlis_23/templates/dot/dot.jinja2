{% macro classes_include(classes) %}{% include "classes.jinja2" %}{% endmacro %}
digraph UML_Class_diagram {
	graph [
		label="UML Class diagram demo";
		labelloc="t";
		fontname="Helvetica,Arial,sans-serif";
        layout="dot";
        splines=spline;
        dpi=96;
        ranksep=1.5
	]
	node [
		fontname="Helvetica,Arial,sans-serif";
		shape=record;
        margin=0.2;
	]
	edge [fontname="Helvetica,Arial,sans-serif"]
	{% for model_group in diagram.model_groups %}
    {%- if model_group.name in model_names %}
    subgraph cluster_{{ model_group.save_oid }} {
        style=filled;
		color=lightgrey;
        label="{{ model_group.name }}";
        {{ classes_include(model_group.classes)|indent }}
        {%- for association in model_group.associations %}
        {%- if association[0][0].split('.')[0] in model_names and association[1][0].split('.')[0] in model_names %}
        edge [dir=back style="" arrowhead="{% if association[1][2] == '' %}{{ "none" }}{% elif association[1][2] == '*' %}{{ "diamond" }}{% else %}{{ "odiamond" }}{% endif %}" arrowtail="{% if association[0][2] == '' %}{{ "none" }}{% elif association[0][2] == '*' %}{{ "diamond" }}{% else %}{{ "odiamond" }}{% endif %}"]
        {{ association[0][0].replace('.', '_') }}:{{ association[1][3].replace('.', '_') }}:e -> {{ association[1][0].replace('.', '_') }}:{{ association[0][3].replace('.', '_') }}:e [constraint=false]
        {%- endif %}
        {%- endfor %}
        {% for topic_group in model_group.topic_groups %}
        subgraph cluster_{{ topic_group.save_oid }} {
		    color=white
            style=solid;
            label="{{ topic_group.name }}";
            {{ classes_include(topic_group.classes)|indent(8) }}
            {%- for association in topic_group.associations %}
            {%- if association[0][0].split('.')[0] in model_names and association[1][0].split('.')[0] in model_names %}
            edge [dir=back style="" arrowhead="{% if association[1][2] == '' %}{{ "none" }}{% elif association[1][2] == '*' %}{{ "diamond" }}{% else %}{{ "odiamond" }}{% endif %}" arrowtail="{% if association[0][2] == '' %}{{ "none" }}{% elif association[0][2] == '*' %}{{ "diamond" }}{% else %}{{ "odiamond" }}{% endif %}"]
            {{ association[0][0].replace('.', '_') }}:{{ association[1][3].replace('.', '_') }}:e -> {{ association[1][0].replace('.', '_') }}:{{ association[0][3].replace('.', '_') }}:e [constraint=false]
            {%- endif %}
            {%- endfor %}
        }
        {% endfor %}
    }
    {%- endif %}
    {%- endfor %}
}